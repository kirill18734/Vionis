
from typing import List, Tuple, Optional
import sqlite3

import bcrypt
from passlib.hash import bcrypt

DB_PATH = "Vionis.db"  # –ø—É—Ç—å –∫ SQLite-–±–∞–∑–µ

# üìò 1. –ß—Ç–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
def read_users() -> List[Tuple[int, str, str]]:
    with sqlite3.connect(DB_PATH) as conn:
        cursor = conn.cursor()
        cursor.execute("SELECT * FROM users")
        return cursor.fetchall()

# ‚úèÔ∏è –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –ø–∞—Ä–æ–ª—è
def insert_user(username: str, email: str, password: str) -> bool:
    hashed_password = bcrypt.hash(password)
    try:
        with sqlite3.connect(DB_PATH) as conn:
            cursor = conn.cursor()
            cursor.execute(
                "INSERT INTO users (name, email, password) VALUES (?, ?, ?)",
                (username, email, hashed_password)
            )
            conn.commit()
        return True
    except sqlite3.IntegrityError:
        return False  # –ª–æ–≥–∏–Ω –∏–ª–∏ email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

# üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è (—Ç–æ–∂–µ —Å —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º)
def update_password(email: str, new_password: str) -> bool:
    hashed_password = bcrypt.hash(new_password)
    with sqlite3.connect(DB_PATH) as conn:
        cursor = conn.cursor()
        cursor.execute(
            "UPDATE users SET password = ? WHERE email = ?",
            (hashed_password, email)
        )
        conn.commit()
        return cursor.rowcount > 0
insert_user('–ö–∏—Ä–∏–ª–ª', 'kira.foka99@gmail.com', 'KKK08III')